define(["jquery","jqueryui","core/log","filter_poodll/utils_amd"],function(a,b,c,d){"use strict";return c.debug("Post Record Dialog: initialising"),{itemid:null,currentitem:null,itemcount:null,cmid:null,instanceprops:null,clone:function(){return a.extend(!0,{},this)},init:function(a){var b=this.clone();b.itemid=a.itemid,b.cmid=a.cmid,b.currentitem=a.currentitem,b.itemcount=a.itemcount,b.instanceprops=a,b.instanceprops.holderid="mod_fluencybuilder_dplaceholder_"+a.currentitem,b.instanceprops.recorderid="mod_fluencybuilder_dplaceholder_"+a.currentitem,b.insert_html(),b.register_events()},insert_html:function(){var b=this.instanceprops,c=a("#"+b.holderid);if(0!=c.length){var d=M.util.get_string("recui_howwasit","mod_fluencybuilder"),e='<div class="hide">';e+='<div class="mod_fluencybuilder_dialogcontentbox" title="'+d+'">',e+='<button type="button" class="mod_fluencybuilder_dbutton mod_fluencybuilder_me_play">me play</button>',e+='<button type="button" class="mod_fluencybuilder_dbutton mod_fluencybuilder_me_ok">me ok</button>',e+=' <button type="button" class="mod_fluencybuilder_dbutton mod_fluencybuilder_me_ng">me ng</button>',e+="</div>",e+="</div>",a(c).prepend(e);var f={the_dialog:a("#"+b.holderid+"  .mod_fluencybuilder_dialogcontentbox"),me_play:a("#"+b.holderid+"  .mod_fluencybuilder_me_play"),me_ok:a("#"+b.holderid+"  .mod_fluencybuilder_me_ok"),me_ng:a("#"+b.holderid+"  .mod_fluencybuilder_me_ng")};b.controls=f}},register_events:function(){var b=this.instanceprops;b.controls.me_play.click(function(){var c=a("#"+b.holderid+"  .poodll_play-recording_fluencybuilder");c.click()});var c=function(){var c=M.util.get_string("recui_next","mod_fluencybuilder"),d={};d[c]=function(){a(this).dialog("close");for(var c=1;c<b.itemcount+1;c++)b.currentitem==b.itemcount&&window.location.replace(M.cfg.wwwroot+"/mod/fluencybuilder/view.php?id="+b.cmid),b.currentitem+1==c?a("#mod_fluencybuilder_dplaceholder_"+c).show():a("#mod_fluencybuilder_dplaceholder_"+c).hide()},b.controls.the_dialog.dialog({dialogClass:"mod_fluencybuilder_no-close",resizable:!1,height:"auto",width:400,modal:!0,buttons:d})},d=a("#"+b.holderid+"  .poodll_modelplayer_fluencybuilder");if(d.length<1)var e=setInterval(function(){var d=a("#"+b.holderid+"  .poodll_modelplayer_fluencybuilder");d.length>0&&(clearInterval(e),d.on("ended",c))},500);else d.on("ended",c)},should_be_checked:function(b){return!!a.isNumeric(this.placeholderduration)&&(!!a.isNumeric(this.mediaduration)&&(parseFloat(this.mediaduration).toFixed(1)==parseFloat(this.placeholderduration).toFixed(1)&&""!=b))},check_updates:function(a,b){if("firstpass"!=b||this.should_be_checked(a)){var d=new XMLHttpRequest,e=this;d.onreadystatechange=function(f){if(4===this.readyState)if(200==d.status){c.debug("ok we got a mediarefresh response");var g=d.responseText,h=JSON.parse(g);if(h)switch(h.code){case"mediaready":e.alertconverted();break;case"stillwaiting":setTimeout(function(){e.check_updates(a,"secondpass")},15e3);break;case"notask":"secondpass"==b&&e.alertconverted();break;case"notloggedin":}}else c.debug("Not 200 response:"+d.status)};var f="filename="+a;d.open("POST",M.cfg.wwwroot+"/filter/poodll/ajaxmediaquery.php",!0),d.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),d.setRequestHeader("Cache-Control","no-cache"),d.send(f)}}}});