define(["jquery","jqueryui","core/log","filter_poodll/utils_amd"],function(a,b,c,d){"use strict";return c.debug("Post Record Dialog: initialising"),{itemid:null,currentitem:null,itemcount:null,cmid:null,instanceprops:null,clone:function(){return a.extend(!0,{},this)},init:function(a){var b=this.clone();b.itemid=a.itemid,b.cmid=a.cmid,b.currentitem=a.currentitem,b.itemcount=a.itemcount,b.instanceprops=a,b.instanceprops.holderid="mod_fluencybuilder_dplaceholder_"+a.currentitem,b.instanceprops.recorderid="mod_fluencybuilder_dplaceholder_"+a.currentitem,b.insert_html(),b.register_events()},insert_html:function(){var b=this.instanceprops,c=a("#"+b.holderid);if(0!=c.length){var d=M.util.get_string("recui_howwasit","mod_fluencybuilder"),e='<div class="hide">';e+='<div class="mod_fluencybuilder_dialogcontentbox" title="'+d+'">',e+='<button type="button" class="mod_fluencybuilder_dbutton mod_fluencybuilder_me_play"><i class="fa fa-play" aria-hidden="true"></i></button>',e+='<button type="button" class="mod_fluencybuilder_dbutton mod_fluencybuilder_me_ok"><i class="fa fa-thumbs-o-up" aria-hidden="true"></i></button>',e+=' <button type="button" class="mod_fluencybuilder_dbutton mod_fluencybuilder_me_ng"><i class="fa fa-thumbs-o-down" aria-hidden="true"></i></button>',e+="</div>",e+="</div>",a(c).prepend(e);var f={the_dialog:a("#"+b.holderid+"  .mod_fluencybuilder_dialogcontentbox"),me_play:a("#"+b.holderid+"  .mod_fluencybuilder_me_play"),me_ok:a("#"+b.holderid+"  .mod_fluencybuilder_me_ok"),me_ng:a("#"+b.holderid+"  .mod_fluencybuilder_me_ng")};b.controls=f}},register_events:function(){var b=this.instanceprops,c=this,d=a("#"+b.holderid+"  .poodll_play-recording_fluencybuilder");b.controls.me_ok.click(function(){c.send_evaluation("ok")}),b.controls.me_ng.click(function(){c.send_evaluation("ng")}),b.controls.me_play.click(function(){d.click()});var e=function(){var c=M.util.get_string("recui_next","mod_fluencybuilder"),d={};d[c]=function(){a(this).dialog("close");for(var c=1;c<b.itemcount+1;c++)if(b.currentitem==b.itemcount&&window.location.replace(M.cfg.wwwroot+"/mod/fluencybuilder/view.php?id="+b.cmid),b.currentitem+1==c){a("#mod_fluencybuilder_dplaceholder_"+c).show();var d=a("#mod_fluencybuilder_dplaceholder_"+c+" .poodll_play-resource_fluencybuilder");d.click()}else a("#mod_fluencybuilder_dplaceholder_"+c).hide()},b.controls.the_dialog.dialog({dialogClass:"mod_fluencybuilder_no-close",resizable:!1,height:"auto",width:400,modal:!0,buttons:d})},f=a("#"+b.holderid+"  .poodll_modelplayer_fluencybuilder");if(f.length<1)var g=setInterval(function(){var c=a("#"+b.holderid+"  .poodll_modelplayer_fluencybuilder");c.length>0&&(clearInterval(g),c.on("ended",e))},500);else f.on("ended",e)},send_evaluation:function(a){var b=new XMLHttpRequest,d=this;b.onreadystatechange=function(a){if(4===this.readyState)if(200==b.status){c.debug("ok we got an attempt update response");var d=b.responseText,e=JSON.parse(d);if(e)switch(e.message){case"noted":c.debug("attempted item evaluation accepted"),e.attemptid!=window.attemptid&&(window.attemptid=e.attemptid);break;case"problem":default:c.debug("attempted item evaluation failure")}}else c.debug("Not 200 response:"+b.status)};var e=0;window.attemptid&&(e=window.attemptid);var f="itemid="+d.itemid+"&cmid="+d.cmid+"&eval="+a+"&attemptid="+e;b.open("POST",M.cfg.wwwroot+"/mod/fluencybuilder/jsonresults.php",!0),b.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),b.setRequestHeader("Cache-Control","no-cache"),b.send(f)}}});